a35ac899 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-04 12:01:18 +1000   1) package com.tle.core.connectors.moodle.service;
1995d058 Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-01 16:28:33 +1000   2) 
0bef9399 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-01-11 11:03:57 +1100   3) import java.io.StringWriter;
1995d058 Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-01 16:28:33 +1000   4) import java.net.HttpURLConnection;
1995d058 Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-01 16:28:33 +1000   5) import java.net.URL;
1995d058 Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-01 16:28:33 +1000   6) import java.util.ArrayList;
c2391b38 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-08-05 10:58:52 +1000   7) import java.util.Date;
1995d058 Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-01 16:28:33 +1000   8) import java.util.List;
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100   9) import java.util.Map;
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000  10) import java.util.Map.Entry;
1995d058 Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-01 16:28:33 +1000  11) 
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100  12) import javax.inject.Inject;
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100  13) 
9eb5f9f1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-06 11:08:04 +1000  14) import org.apache.log4j.Logger;
0bef9399 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-01-11 11:03:57 +1100  15) import org.ccil.cowan.tagsoup.Parser;
9eb5f9f1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-06 11:08:04 +1000  16) import org.w3c.dom.Node;
0bef9399 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-01-11 11:03:57 +1100  17) import org.xml.sax.InputSource;
0bef9399 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-01-11 11:03:57 +1100  18) import org.xml.sax.XMLReader;
1995d058 Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-01 16:28:33 +1000  19) 
0bef9399 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-01-11 11:03:57 +1100  20) import com.dytech.common.io.UnicodeReader;
0bef9399 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-01-11 11:03:57 +1100  21) import com.dytech.edge.common.Constants;
48e6ae6b Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2013-01-14 16:29:32 +1100  22) import com.google.common.base.Throwables;
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000  23) import com.google.common.collect.Lists;
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100  24) import com.google.common.collect.Maps;
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000  25) import com.google.common.io.Closeables;
56ed250d Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-07-05 13:23:34 +1000  26) import com.tle.beans.item.Item;
0eec36c4 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-08-05 16:53:03 +1000  27) import com.tle.beans.item.ItemId;
56ed250d Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-07-05 13:23:34 +1000  28) import com.tle.beans.item.ViewableItemType;
88bf9925 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-08-10 16:39:15 +1000  29) import com.tle.beans.item.attachments.Attachment;
9eb5f9f1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-06 11:08:04 +1000  30) import com.tle.common.Check;
73be6016 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2012-10-03 16:54:30 +1000  31) import com.tle.common.NameValue;
0e40966f Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-01-09 14:32:56 +1100  32) import com.tle.common.URLUtils;
4d0dba21 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-07-27 10:22:53 +1000  33) import com.tle.common.connectors.ConnectorContent;
1995d058 Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-01 16:28:33 +1000  34) import com.tle.common.connectors.ConnectorCourse;
c0f58655 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-19 09:50:20 +1000  35) import com.tle.common.connectors.ConnectorFolder;
f7e9e6c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-08-10 16:38:04 +1000  36) import com.tle.common.connectors.ConnectorTerminology;
1995d058 Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-01 16:28:33 +1000  37) import com.tle.common.connectors.entity.Connector;
56ed250d Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-07-05 13:23:34 +1000  38) import com.tle.common.i18n.CurrentLocale;
b9aeb851 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-14 16:50:47 +1100  39) import com.tle.common.searching.SearchResults;
1714afe4 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-15 10:43:59 +1100  40) import com.tle.common.searching.SimpleSearchResults;
9eb5f9f1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-06 11:08:04 +1000  41) import com.tle.common.util.XmlDocument;
cd4389e1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-21 13:32:45 +1000  42) import com.tle.core.connectors.exception.LmsUserNotFoundException;
0bef9399 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-01-11 11:03:57 +1100  43) import com.tle.core.connectors.moodle.EntityStrippingWriter;
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000  44) import com.tle.core.connectors.moodle.MoodleConnectorConstants;
88bf9925 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-08-10 16:39:15 +1000  45) import com.tle.core.connectors.service.AbstractIntegrationConnectorRespository;
b55c9f92 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 11:38:25 +1100  46) import com.tle.core.connectors.service.ConnectorRepositoryService.ExternalContentSortType;
1995d058 Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-01 16:28:33 +1000  47) import com.tle.core.guice.Bind;
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100  48) import com.tle.core.services.HttpService;
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100  49) import com.tle.core.services.config.ConfigurationService;
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000  50) import com.tle.core.services.http.Request;
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000  51) import com.tle.core.services.http.Request.Method;
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000  52) import com.tle.core.services.http.Response;
88bf9925 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-08-10 16:39:15 +1000  53) import com.tle.web.integration.Integration.LmsLink;
88bf9925 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-08-10 16:39:15 +1000  54) import com.tle.web.integration.Integration.LmsLinkInfo;
88bf9925 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-08-10 16:39:15 +1000  55) import com.tle.web.selection.SelectedResource;
88bf9925 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-08-10 16:39:15 +1000  56) import com.tle.web.viewable.ViewableItem;
1995d058 Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-01 16:28:33 +1000  57) 
9eb5f9f1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-06 11:08:04 +1000  58) @SuppressWarnings("nls")
1995d058 Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-01 16:28:33 +1000  59) @Bind
88bf9925 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-08-10 16:39:15 +1000  60) public class MoodleConnectorService extends AbstractIntegrationConnectorRespository
1995d058 Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-01 16:28:33 +1000  61) {
9eb5f9f1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-06 11:08:04 +1000  62) 	private static final Logger LOGGER = Logger.getLogger(MoodleConnectorService.class);
9eb5f9f1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-06 11:08:04 +1000  63) 
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100  64) 	@Inject
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100  65) 	private HttpService httpService;
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100  66) 	@Inject
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100  67) 	private ConfigurationService configService;
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100  68) 
1995d058 Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-01 16:28:33 +1000  69) 	@Override
cb120628 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (lcook           2012-11-08 09:21:51 +1100  70) 	@SuppressWarnings("null")
dcf694a7 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (nread           2012-03-26 15:38:37 +1100  71) 	public ConnectorFolder addItemToCourse(Connector connector, String username, String courseId, String sectionId,
ac21c94a Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-04-03 10:34:20 +1000  72) 		Item item, SelectedResource selectedResource) throws LmsUserNotFoundException
1995d058 Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-01 16:28:33 +1000  73) 	{
0224e54d Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-14 15:29:54 +1100  74) 		final LmsLinkInfo lmsLinkInfo = getLmsLink(item, selectedResource);
88bf9925 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-08-10 16:39:15 +1000  75) 		final LmsLink lmsLink = lmsLinkInfo.getLmsLink();
88bf9925 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-08-10 16:39:15 +1000  76) 		final Item resourcesItem = lmsLinkInfo.getResourceItem();
0eec36c4 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-08-05 16:53:03 +1000  77) 
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000  78) 		final MoodleWebService ws = setupService(connector);
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000  79) 		final Map<String, String> data = functionCall(ws, "equella_add_item_to_course");
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100  80) 		param(data, "user", username);
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100  81) 		param(data, "courseid", courseId);
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100  82) 		param(data, "sectionid", sectionId);
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100  83) 		param(data, "itemUuid", resourcesItem.getUuid());
dcf694a7 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (nread           2012-03-26 15:38:37 +1100  84) 		param(data, "itemVersion", String.valueOf(selectedResource.isLatest() ? 0 : resourcesItem.getVersion()));
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100  85) 		param(data, "url", lmsLink.getUrl());
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100  86) 		param(data, "title", lmsLink.getName());
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100  87) 		param(data, "description", lmsLink.getDescription());
88bf9925 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-08-10 16:39:15 +1000  88) 		final Attachment attachment = lmsLinkInfo.getResourceAttachment();
fe199eb1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2012-01-09 16:00:43 +1100  89) 		param(data, "attachmentUuid", attachment == null ? "" : attachment.getUuid());
1995d058 Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-01 16:28:33 +1000  90) 
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000  91) 		ConnectorCourse course = null;
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000  92) 		ConnectorFolder folder = null;
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100  93) 		final XmlDocument response = ws.call(data);
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000  94) 		for( Node keyNode : response.nodeList("//KEY") )
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000  95) 		{
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000  96) 			final String key = keyNode.getAttributes().getNamedItem("name").getNodeValue();
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000  97) 			final String value = response.nodeValue("VALUE", keyNode);
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000  98) 
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000  99) 			if( key.equals("courseid") )
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000 100) 			{
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000 101) 				course = new ConnectorCourse(value);
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000 102) 			}
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000 103) 			else if( key.equals("coursename") )
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000 104) 			{
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000 105) 				course.setName(value);
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000 106) 			}
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000 107) 			else if( key.equals("sectionid") )
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000 108) 			{
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000 109) 				folder = new ConnectorFolder(value, course);
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000 110) 			}
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000 111) 			else if( key.equals("sectionname") )
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000 112) 			{
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000 113) 				folder.setName(value);
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000 114) 				course.addFolder(folder);
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000 115) 			}
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000 116) 		}
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000 117) 		return folder;
a4aa88cf Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-04 11:55:40 +1000 118) 	}
a4aa88cf Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-04 11:55:40 +1000 119) 
a4aa88cf Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-04 11:55:40 +1000 120) 	@Override
88bf9925 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-08-10 16:39:15 +1000 121) 	protected ViewableItem createViewableItem(ItemId itemId, boolean latest)
88bf9925 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-08-10 16:39:15 +1000 122) 	{
dcf694a7 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (nread           2012-03-26 15:38:37 +1100 123) 		return viewableItemFactory.createIntegrationViewableItem(itemId, ViewableItemType.GENERIC, latest);
88bf9925 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-08-10 16:39:15 +1000 124) 	}
88bf9925 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-08-10 16:39:15 +1000 125) 
88bf9925 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-08-10 16:39:15 +1000 126) 	@Override
88bf9925 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-08-10 16:39:15 +1000 127) 	protected String getIntegrationId()
88bf9925 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-08-10 16:39:15 +1000 128) 	{
88bf9925 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-08-10 16:39:15 +1000 129) 		return "gen";
88bf9925 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-08-10 16:39:15 +1000 130) 	}
88bf9925 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-08-10 16:39:15 +1000 131) 
88bf9925 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-08-10 16:39:15 +1000 132) 	@Override
88bf9925 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-08-10 16:39:15 +1000 133) 	protected boolean isRelativeUrls()
88bf9925 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-08-10 16:39:15 +1000 134) 	{
88bf9925 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-08-10 16:39:15 +1000 135) 		return false;
88bf9925 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-08-10 16:39:15 +1000 136) 	}
88bf9925 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-08-10 16:39:15 +1000 137) 
88bf9925 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-08-10 16:39:15 +1000 138) 	@Override
cb120628 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (lcook           2012-11-08 09:21:51 +1100 139) 	@SuppressWarnings("null")
dcf694a7 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (nread           2012-03-26 15:38:37 +1100 140) 	public List<ConnectorCourse> getCourses(Connector connector, String username, boolean editable, boolean archived)
ac21c94a Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-04-03 10:34:20 +1000 141) 		throws LmsUserNotFoundException
a4aa88cf Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-04 11:55:40 +1000 142) 	{
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000 143) 		final MoodleWebService ws = setupService(connector);
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 144) 		final Map<String, String> data = functionCall(ws, "equella_list_courses_for_user");
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 145) 		param(data, "user", username);
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 146) 		param(data, "modifiable", editable);
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 147) 		param(data, "archived", archived);
1995d058 Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-01 16:28:33 +1000 148) 		final List<ConnectorCourse> courses = new ArrayList<ConnectorCourse>();
1995d058 Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-01 16:28:33 +1000 149) 
9eb5f9f1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-06 11:08:04 +1000 150) 		ConnectorCourse course = null;
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 151) 		final XmlDocument response = ws.call(data);
9eb5f9f1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-06 11:08:04 +1000 152) 		for( Node keyNode : response.nodeList("//KEY") )
1995d058 Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-01 16:28:33 +1000 153) 		{
9eb5f9f1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-06 11:08:04 +1000 154) 			final String key = keyNode.getAttributes().getNamedItem("name").getNodeValue();
9eb5f9f1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-06 11:08:04 +1000 155) 			final String value = response.nodeValue("VALUE", keyNode);
9eb5f9f1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-06 11:08:04 +1000 156) 
9eb5f9f1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-06 11:08:04 +1000 157) 			if( key.equals("courseid") )
1995d058 Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-01 16:28:33 +1000 158) 			{
9eb5f9f1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-06 11:08:04 +1000 159) 				if( course != null )
1995d058 Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-01 16:28:33 +1000 160) 				{
9eb5f9f1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-06 11:08:04 +1000 161) 					courses.add(course);
9eb5f9f1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-06 11:08:04 +1000 162) 				}
9eb5f9f1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-06 11:08:04 +1000 163) 				course = new ConnectorCourse(value);
9eb5f9f1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-06 11:08:04 +1000 164) 			}
9eb5f9f1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-06 11:08:04 +1000 165) 			else if( key.equals("coursename") )
9eb5f9f1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-06 11:08:04 +1000 166) 			{
c0f58655 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-19 09:50:20 +1000 167) 				course.setName(value);
9eb5f9f1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-06 11:08:04 +1000 168) 			}
d32867cf Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-14 13:06:51 +1100 169) 			else if( key.equals("archived") )
d32867cf Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-14 13:06:51 +1100 170) 			{
d32867cf Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-14 13:06:51 +1100 171) 				course.setAvailable(value.equals("0"));
d32867cf Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-14 13:06:51 +1100 172) 			}
9eb5f9f1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-06 11:08:04 +1000 173) 		}
9eb5f9f1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-06 11:08:04 +1000 174) 		if( course != null )
9eb5f9f1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-06 11:08:04 +1000 175) 		{
9eb5f9f1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-06 11:08:04 +1000 176) 			courses.add(course);
9eb5f9f1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-06 11:08:04 +1000 177) 		}
9eb5f9f1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-06 11:08:04 +1000 178) 		return courses;
9eb5f9f1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-06 11:08:04 +1000 179) 	}
1995d058 Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-01 16:28:33 +1000 180) 
9eb5f9f1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-06 11:08:04 +1000 181) 	@Override
cb120628 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (lcook           2012-11-08 09:21:51 +1100 182) 	@SuppressWarnings("null")
dcf694a7 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (nread           2012-03-26 15:38:37 +1100 183) 	public List<ConnectorFolder> getFoldersForCourse(Connector connector, String username, String courseId)
dcf694a7 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (nread           2012-03-26 15:38:37 +1100 184) 		throws LmsUserNotFoundException
cd4389e1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-21 13:32:45 +1000 185) 	{
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000 186) 		final MoodleWebService ws = setupService(connector);
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 187) 		final Map<String, String> data = functionCall(ws, "equella_list_sections_for_course");
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 188) 		param(data, "user", username);
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 189) 		param(data, "courseid", courseId);
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000 190) 
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000 191) 		final List<ConnectorFolder> folders = new ArrayList<ConnectorFolder>();
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000 192) 
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000 193) 		final ConnectorCourse course = new ConnectorCourse(courseId);
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000 194) 		ConnectorFolder folder = null;
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 195) 		final XmlDocument response = ws.call(data);
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000 196) 		for( Node keyNode : response.nodeList("//KEY") )
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000 197) 		{
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000 198) 			final String key = keyNode.getAttributes().getNamedItem("name").getNodeValue();
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000 199) 			final String value = response.nodeValue("VALUE", keyNode);
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000 200) 
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000 201) 			if( key.equals("sectionid") )
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000 202) 			{
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000 203) 				if( folder != null )
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000 204) 				{
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000 205) 					folders.add(folder);
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000 206) 				}
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000 207) 				folder = new ConnectorFolder(value, course);
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000 208) 				folder.setLeaf(true);
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000 209) 			}
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000 210) 			else if( key.equals("sectionname") )
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000 211) 			{
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000 212) 				folder.setName(value);
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000 213) 			}
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000 214) 		}
1d719c71 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-08-03 14:09:06 +1000 215) 
1d719c71 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-08-03 14:09:06 +1000 216) 		if( folder != null )
1d719c71 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-08-03 14:09:06 +1000 217) 		{
1d719c71 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-08-03 14:09:06 +1000 218) 			folders.add(folder);
1d719c71 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-08-03 14:09:06 +1000 219) 		}
1d719c71 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-08-03 14:09:06 +1000 220) 
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000 221) 		return folders;
cd4389e1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-21 13:32:45 +1000 222) 	}
cd4389e1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-21 13:32:45 +1000 223) 
cd4389e1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-21 13:32:45 +1000 224) 	@Override
dcf694a7 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (nread           2012-03-26 15:38:37 +1100 225) 	public List<ConnectorFolder> getFoldersForFolder(Connector connector, String username, String courseId,
dcf694a7 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (nread           2012-03-26 15:38:37 +1100 226) 		String folderId) throws LmsUserNotFoundException
cd4389e1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-21 13:32:45 +1000 227) 	{
ba2aa962 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-25 14:04:30 +1000 228) 		return Lists.newArrayList();
cd4389e1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-21 13:32:45 +1000 229) 	}
cd4389e1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-21 13:32:45 +1000 230) 
cd4389e1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-21 13:32:45 +1000 231) 	@Override
dcf694a7 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (nread           2012-03-26 15:38:37 +1100 232) 	public List<ConnectorContent> findUsages(Connector connector, String username, String uuid, int version,
dcf694a7 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (nread           2012-03-26 15:38:37 +1100 233) 		boolean versionIsLatest, boolean archived, boolean allVersion) throws LmsUserNotFoundException
8bca0813 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-07-21 14:02:38 +1000 234) 	{
8bca0813 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-07-21 14:02:38 +1000 235) 		MoodleWebService ws = setupService(connector);
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 236) 		final Map<String, String> data = functionCall(ws, "equella_find_usage_for_item");
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 237) 		param(data, "user", username);
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 238) 		param(data, "uuid", uuid);
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 239) 		param(data, "version", version);
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 240) 		param(data, "archived", archived);
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 241) 		param(data, "allVersion", allVersion);
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 242) 		param(data, "isLatest", versionIsLatest);
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 243) 
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 244) 		XmlDocument response = ws.call(data);
fd4fb997 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-15 10:21:55 +1100 245) 		return parseResponse(response, connector.getServerUrl());
fd4fb997 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-15 10:21:55 +1100 246) 	}
fd4fb997 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-15 10:21:55 +1100 247) 
fd4fb997 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-15 10:21:55 +1100 248) 	@Override
dcf694a7 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (nread           2012-03-26 15:38:37 +1100 249) 	public SearchResults<ConnectorContent> findAllUsages(Connector connector, String username, String query,
dcf694a7 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (nread           2012-03-26 15:38:37 +1100 250) 		String courseId, String folderId, boolean archived, int offset, int count, ExternalContentSortType sortType,
dcf694a7 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (nread           2012-03-26 15:38:37 +1100 251) 		boolean reverseSort) throws LmsUserNotFoundException
fd4fb997 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-15 10:21:55 +1100 252) 	{
fd4fb997 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-15 10:21:55 +1100 253) 		MoodleWebService ws = setupService(connector);
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 254) 		final Map<String, String> data = functionCall(ws, "equella_find_all_usage");
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 255) 		param(data, "user", username);
bdf507d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-20 15:35:39 +1100 256) 		param(data, "query", query.replace("*", "%"));
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 257) 		param(data, "courseid", Check.isEmpty(courseId) ? 0 : Integer.valueOf(courseId));
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 258) 		param(data, "sectionid", Check.isEmpty(folderId) ? 0 : Integer.valueOf(folderId));
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 259) 		param(data, "archived", archived);
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 260) 		param(data, "offset", offset);
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 261) 		param(data, "count", count);
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 262) 
b55c9f92 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 11:38:25 +1100 263) 		final String sortColumn;
b55c9f92 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 11:38:25 +1100 264) 		switch( sortType )
b55c9f92 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 11:38:25 +1100 265) 		{
92845f45 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (Jolse Maginnis  2013-01-23 13:31:23 +1100 266) 			case COURSE:
92845f45 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (Jolse Maginnis  2013-01-23 13:31:23 +1100 267) 				sortColumn = "course";
92845f45 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (Jolse Maginnis  2013-01-23 13:31:23 +1100 268) 				break;
92845f45 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (Jolse Maginnis  2013-01-23 13:31:23 +1100 269) 			case NAME:
92845f45 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (Jolse Maginnis  2013-01-23 13:31:23 +1100 270) 				sortColumn = "name";
92845f45 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (Jolse Maginnis  2013-01-23 13:31:23 +1100 271) 				break;
92845f45 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (Jolse Maginnis  2013-01-23 13:31:23 +1100 272) 			case DATE_ADDED:
92845f45 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (Jolse Maginnis  2013-01-23 13:31:23 +1100 273) 			default:
92845f45 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (Jolse Maginnis  2013-01-23 13:31:23 +1100 274) 				sortColumn = "timecreated";
92845f45 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (Jolse Maginnis  2013-01-23 13:31:23 +1100 275) 				break;
b55c9f92 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 11:38:25 +1100 276) 		}
b55c9f92 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 11:38:25 +1100 277) 		param(data, "sortcolumn", sortColumn);
dcf694a7 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (nread           2012-03-26 15:38:37 +1100 278) 		param(data, "sortasc", sortType == ExternalContentSortType.DATE_ADDED ? reverseSort : !reverseSort);
b55c9f92 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 11:38:25 +1100 279) 
b55c9f92 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 11:38:25 +1100 280) 		final XmlDocument response = ws.call(data);
b55c9f92 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 11:38:25 +1100 281) 		final List<ConnectorContent> content = parseResponse(response, connector.getServerUrl());
b55c9f92 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 11:38:25 +1100 282) 		final String available = getValue(response, "/RESPONSE/SINGLE/", "available", null);
04e8cc65 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-22 14:59:37 +1100 283) 		if( available == null )
04e8cc65 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-22 14:59:37 +1100 284) 		{
dcf694a7 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (nread           2012-03-26 15:38:37 +1100 285) 			// some error has occurred...
04e8cc65 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-22 14:59:37 +1100 286) 			throw new RuntimeException("Error contacting Moodle server");
04e8cc65 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-22 14:59:37 +1100 287) 		}
dcf694a7 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (nread           2012-03-26 15:38:37 +1100 288) 		return new SimpleSearchResults<ConnectorContent>(content, content.size(), offset, Integer.valueOf(available));
1714afe4 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-15 10:43:59 +1100 289) 	}
1714afe4 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-15 10:43:59 +1100 290) 
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 291) 	public String getValue(XmlDocument xml, String key, Node nodeContext)
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 292) 	{
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 293) 		return getValue(xml, "", key, nodeContext);
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 294) 	}
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 295) 
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 296) 	public String getValue(XmlDocument xml, String precedingXpath, String key, Node nodeContext)
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 297) 	{
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 298) 		return xml.nodeValue(precedingXpath + "KEY[@name=\"" + key + "\"]/VALUE", nodeContext);
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 299) 	}
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 300) 
1714afe4 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-15 10:43:59 +1100 301) 	@Override
dcf694a7 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (nread           2012-03-26 15:38:37 +1100 302) 	public int getUnfilteredAllUsagesCount(Connector connector, String username, String query, boolean archived)
ac21c94a Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-04-03 10:34:20 +1000 303) 		throws LmsUserNotFoundException
1714afe4 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-15 10:43:59 +1100 304) 	{
584ebf97 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-20 12:19:43 +1100 305) 		MoodleWebService ws = setupService(connector);
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 306) 		final Map<String, String> data = functionCall(ws, "equella_unfiltered_usage_count");
584ebf97 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-20 12:19:43 +1100 307) 		param(data, "user", username);
584ebf97 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-20 12:19:43 +1100 308) 		param(data, "query", query);
584ebf97 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-20 12:19:43 +1100 309) 		param(data, "archived", archived);
584ebf97 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-20 12:19:43 +1100 310) 
584ebf97 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-20 12:19:43 +1100 311) 		final XmlDocument response = ws.call(data);
584ebf97 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-20 12:19:43 +1100 312) 
584ebf97 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-20 12:19:43 +1100 313) 		for( Node keyNode : response.nodeList("RESPONSE/SINGLE/KEY") )
584ebf97 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-20 12:19:43 +1100 314) 		{
584ebf97 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-20 12:19:43 +1100 315) 			final String key = keyNode.getAttributes().getNamedItem("name").getNodeValue();
584ebf97 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-20 12:19:43 +1100 316) 			final String value = response.nodeValue("VALUE", keyNode);
584ebf97 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-20 12:19:43 +1100 317) 
584ebf97 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-20 12:19:43 +1100 318) 			if( key.equals("available") )
584ebf97 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-20 12:19:43 +1100 319) 			{
584ebf97 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-20 12:19:43 +1100 320) 				return Integer.parseInt(value);
584ebf97 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-20 12:19:43 +1100 321) 			}
584ebf97 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-20 12:19:43 +1100 322) 		}
584ebf97 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-20 12:19:43 +1100 323) 
1714afe4 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-15 10:43:59 +1100 324) 		return 0;
fd4fb997 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-15 10:21:55 +1100 325) 	}
fd4fb997 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-15 10:21:55 +1100 326) 
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 327) 	@SuppressWarnings("null")
fd4fb997 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-15 10:21:55 +1100 328) 	private List<ConnectorContent> parseResponse(XmlDocument response, String moodleServerUrl)
fd4fb997 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-15 10:21:55 +1100 329) 	{
fd4fb997 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-15 10:21:55 +1100 330) 		ArrayList<ConnectorContent> contentList = new ArrayList<ConnectorContent>();
eb4ef665 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-07-27 15:53:52 +1000 331) 		ConnectorContent content = null;
eb4ef665 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-07-27 15:53:52 +1000 332) 		String attributeKey = null;
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 333) 		Node resultsRoot = response.node("/RESPONSE/SINGLE/KEY[@name=\"results\"]/MULTIPLE");
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 334) 		for( Node singleNode : response.nodeList("SINGLE", resultsRoot) )
4d0dba21 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-07-27 10:22:53 +1000 335) 		{
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 336) 			for( Node keyNode : response.nodeList(".//KEY", singleNode) )
4d0dba21 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-07-27 10:22:53 +1000 337) 			{
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 338) 				final String key = keyNode.getAttributes().getNamedItem("name").getNodeValue();
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 339) 				final String value = response.nodeValue("VALUE", keyNode);
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 340) 
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 341) 				if( key.equals("id") )
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 342) 				{
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 343) 					content = new ConnectorContent(value);
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 344) 					contentList.add(content);
dcf694a7 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (nread           2012-03-26 15:38:37 +1100 345) 					content.setExternalUrl(URLUtils.newURL(moodleServerUrl, "mod/equella/view.php?id=" + value)
dcf694a7 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (nread           2012-03-26 15:38:37 +1100 346) 						.toString());
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 347) 				}
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 348) 				if( key.equals("coursename") )
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 349) 				{
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 350) 					content.setCourse(value);
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 351) 				}
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 352) 				else if( key.equals("courseid") )
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 353) 				{
dcf694a7 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (nread           2012-03-26 15:38:37 +1100 354) 					content.setCourseUrl(URLUtils.newURL(moodleServerUrl, "course/view.php?id=" + value).toString());
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 355) 				}
0e40966f Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-01-09 14:32:56 +1100 356) 				else if( key.equals("section") )
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 357) 				{
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 358) 					content.setFolder(value);
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 359) 				}
cb120628 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (lcook           2012-11-08 09:21:51 +1100 360) 				// else if( key.equals("sectionid") )
cb120628 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (lcook           2012-11-08 09:21:51 +1100 361) 				// {
11b3ab8d Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (Jolse Maginnis  2013-01-22 10:54:30 +1100 362) 				// No, this is for folders, not sections. In fact, you can't
11b3ab8d Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (Jolse Maginnis  2013-01-22 10:54:30 +1100 363) 				// add to folders via the 'push' interface. A bit of an
11b3ab8d Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (Jolse Maginnis  2013-01-22 10:54:30 +1100 364) 				// oversight...
11b3ab8d Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (Jolse Maginnis  2013-01-22 10:54:30 +1100 365) 				// if( !Check.isEmpty(value) )
11b3ab8d Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (Jolse Maginnis  2013-01-22 10:54:30 +1100 366) 				// {
11b3ab8d Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (Jolse Maginnis  2013-01-22 10:54:30 +1100 367) 				// int folderId = Integer.parseInt(value);
11b3ab8d Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (Jolse Maginnis  2013-01-22 10:54:30 +1100 368) 				// if( folderId != 0 )
11b3ab8d Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (Jolse Maginnis  2013-01-22 10:54:30 +1100 369) 				// {
11b3ab8d Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (Jolse Maginnis  2013-01-22 10:54:30 +1100 370) 				// content.setFolderUrl(URLUtils.newURL(moodleServerUrl,
11b3ab8d Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (Jolse Maginnis  2013-01-22 10:54:30 +1100 371) 				// "mod/folder/view.php?id=" + value).toString());
11b3ab8d Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (Jolse Maginnis  2013-01-22 10:54:30 +1100 372) 				// }
11b3ab8d Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (Jolse Maginnis  2013-01-22 10:54:30 +1100 373) 				// }
cb120628 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (lcook           2012-11-08 09:21:51 +1100 374) 				// }
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 375) 				else if( key.equals("dateAdded") )
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 376) 				{
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 377) 					content.setDateAdded(new Date(Long.parseLong(value)));
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 378) 				}
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 379) 				else if( key.equals("dateModified") )
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 380) 				{
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 381) 					content.setDateModified(new Date(Long.parseLong(value)));
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 382) 				}
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 383) 				else if( key.equals("uuid") )
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 384) 				{
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 385) 					content.setUuid(value);
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 386) 				}
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 387) 				else if( key.equals("version") )
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 388) 				{
0e40966f Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-01-09 14:32:56 +1100 389) 					if( !Check.isEmpty(value) )
0e40966f Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-01-09 14:32:56 +1100 390) 					{
0e40966f Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-01-09 14:32:56 +1100 391) 						content.setVersion(Integer.parseInt(value));
0e40966f Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-01-09 14:32:56 +1100 392) 					}
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 393) 				}
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 394) 				else if( key.equals("moodlename") )
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 395) 				{
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 396) 					content.setExternalTitle(value);
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 397) 				}
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 398) 				else if( key.equals("moodledescription") )
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 399) 				{
fc8a96c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-01-06 10:45:15 +1100 400) 					content.setExternalDescription(value);
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 401) 				}
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 402) 				else if( key.equals("attachment") )
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 403) 				{
04e8cc65 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-22 14:59:37 +1100 404) 					content.setAttachmentUrl(value);
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 405) 				}
0e40966f Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-01-09 14:32:56 +1100 406) 				else if( key.equals("attachmentUuid") )
0e40966f Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-01-09 14:32:56 +1100 407) 				{
0e40966f Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-01-09 14:32:56 +1100 408) 					content.setAttachmentUuid(value);
0e40966f Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-01-09 14:32:56 +1100 409) 				}
227e9a41 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-20 09:50:21 +1100 410) 				else if( key.equals("coursecode") )
227e9a41 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-20 09:50:21 +1100 411) 				{
227e9a41 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-20 09:50:21 +1100 412) 					content.setCourseCode(value);
227e9a41 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-20 09:50:21 +1100 413) 				}
227e9a41 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-20 09:50:21 +1100 414) 				else if( key.equals("instructor") )
227e9a41 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-20 09:50:21 +1100 415) 				{
dcf694a7 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (nread           2012-03-26 15:38:37 +1100 416) 					content.setAttribute(ConnectorContent.KEY_INSTRUCTOR, getKey("finduses.instructor"), value);
227e9a41 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-20 09:50:21 +1100 417) 				}
227e9a41 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-20 09:50:21 +1100 418) 				else if( key.equals("dateAccessed") )
227e9a41 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-20 09:50:21 +1100 419) 				{
227e9a41 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-20 09:50:21 +1100 420) 					if( !Check.isEmpty(value) )
227e9a41 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-20 09:50:21 +1100 421) 					{
dcf694a7 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (nread           2012-03-26 15:38:37 +1100 422) 						content.setAttribute(ConnectorContent.KEY_DATE_ACCESSED, getKey("finduses.dateAccessed"),
dcf694a7 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (nread           2012-03-26 15:38:37 +1100 423) 							new Date(Long.parseLong(value)));
227e9a41 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-20 09:50:21 +1100 424) 					}
227e9a41 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-20 09:50:21 +1100 425) 				}
227e9a41 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-20 09:50:21 +1100 426) 				else if( key.equals("enrollments") )
227e9a41 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-20 09:50:21 +1100 427) 				{
227e9a41 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-20 09:50:21 +1100 428) 					if( !Check.isEmpty(value) )
227e9a41 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-20 09:50:21 +1100 429) 					{
dcf694a7 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (nread           2012-03-26 15:38:37 +1100 430) 						content.setAttribute(ConnectorContent.KEY_ENROLLMENTS, getKey("finduses.enrollments"),
dcf694a7 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (nread           2012-03-26 15:38:37 +1100 431) 							Integer.valueOf(value));
227e9a41 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-20 09:50:21 +1100 432) 					}
227e9a41 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-20 09:50:21 +1100 433) 				}
227e9a41 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-20 09:50:21 +1100 434) 				else if( key.equals("visible") )
227e9a41 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-20 09:50:21 +1100 435) 				{
227e9a41 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-20 09:50:21 +1100 436) 					content.setAvailable(Integer.parseInt(value) == 1 ? true : false);
dcf694a7 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (nread           2012-03-26 15:38:37 +1100 437) 					content.setAttribute("visible", getKey("finduses.visible"), Integer.parseInt(value) == 1 ? true
dcf694a7 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (nread           2012-03-26 15:38:37 +1100 438) 						: false);
227e9a41 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-20 09:50:21 +1100 439) 				}
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 440) 
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 441) 				else if( key.equals("key") )
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 442) 				{
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 443) 					attributeKey = value;
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 444) 				}
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 445) 				else if( key.equals("value") )
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 446) 				{
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 447) 					if( !Check.isEmpty(value) )
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 448) 					{
dcf694a7 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (nread           2012-03-26 15:38:37 +1100 449) 						content.setAttribute(attributeKey, getKey("finduses." + attributeKey), value);
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 450) 					}
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 451) 				}
eb4ef665 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-07-27 15:53:52 +1000 452) 			}
4d0dba21 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-07-27 10:22:53 +1000 453) 		}
eb4ef665 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-07-27 15:53:52 +1000 454) 		return contentList;
8bca0813 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-07-21 14:02:38 +1000 455) 	}
8bca0813 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-07-21 14:02:38 +1000 456) 
02aee0fc Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-08-05 14:10:43 +1000 457) 	@Override
dcf694a7 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (nread           2012-03-26 15:38:37 +1100 458) 	public String getCourseCode(Connector connector, String username, String courseId) throws LmsUserNotFoundException
02aee0fc Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-08-05 14:10:43 +1000 459) 	{
0eec36c4 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-08-05 16:53:03 +1000 460) 		final MoodleWebService ws = setupService(connector);
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 461) 		final Map<String, String> data = functionCall(ws, "equella_get_course_code");
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 462) 		param(data, "user", username);
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 463) 		param(data, "courseid", courseId);
0eec36c4 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-08-05 16:53:03 +1000 464) 
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 465) 		XmlDocument response = ws.call(data);
0eec36c4 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-08-05 16:53:03 +1000 466) 
0eec36c4 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-08-05 16:53:03 +1000 467) 		String courseCode = null;
0eec36c4 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-08-05 16:53:03 +1000 468) 		for( Node keyNode : response.nodeList("//KEY") )
0eec36c4 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-08-05 16:53:03 +1000 469) 		{
0eec36c4 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-08-05 16:53:03 +1000 470) 			final String key = keyNode.getAttributes().getNamedItem("name").getNodeValue();
0eec36c4 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-08-05 16:53:03 +1000 471) 			final String value = response.nodeValue("VALUE", keyNode);
0eec36c4 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-08-05 16:53:03 +1000 472) 
0eec36c4 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-08-05 16:53:03 +1000 473) 			if( key.equals("coursecode") )
0eec36c4 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-08-05 16:53:03 +1000 474) 			{
0eec36c4 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-08-05 16:53:03 +1000 475) 				courseCode = value;
0eec36c4 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-08-05 16:53:03 +1000 476) 			}
0eec36c4 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-08-05 16:53:03 +1000 477) 		}
0eec36c4 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-08-05 16:53:03 +1000 478) 
0eec36c4 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-08-05 16:53:03 +1000 479) 		return courseCode;
02aee0fc Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-08-05 14:10:43 +1000 480) 	}
02aee0fc Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-08-05 14:10:43 +1000 481) 
9eb5f9f1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-06 11:08:04 +1000 482) 	private String errorString(String partKey)
9eb5f9f1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-06 11:08:04 +1000 483) 	{
9eb5f9f1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-06 11:08:04 +1000 484) 		return CurrentLocale.get("com.tle.core.connectors.moodle." + partKey);
1995d058 Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-01 16:28:33 +1000 485) 	}
1995d058 Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-01 16:28:33 +1000 486) 
a4aa88cf Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-04 11:55:40 +1000 487) 	private MoodleWebService setupService(Connector connector)
a4aa88cf Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-04 11:55:40 +1000 488) 	{
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 489) 		return setupService(connector.getServerUrl(),
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 490) 			connector.getAttribute(MoodleConnectorConstants.FIELD_WEBSERVICE_TOKEN));
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 491) 	}
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 492) 
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 493) 	private MoodleWebService setupService(String serverUrl, String webServiceToken)
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 494) 	{
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 495) 		return new MoodleWebService(URLUtils.newURL(serverUrl, "webservice/rest/server.php").toString(),
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 496) 			webServiceToken);
a4aa88cf Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-04 11:55:40 +1000 497) 	}
a4aa88cf Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-04 11:55:40 +1000 498) 
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 499) 	private Map<String, String> functionCall(MoodleWebService ws, String function)
a4aa88cf Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-04 11:55:40 +1000 500) 	{
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 501) 		final Map<String, String> params = Maps.newHashMap();
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 502) 		params.put("wsfunction", function);
0e40966f Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-01-09 14:32:56 +1100 503) 		params.put("wstoken", ws.getToken());
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 504) 		return params;
9eb5f9f1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-06 11:08:04 +1000 505) 	}
a4aa88cf Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-04 11:55:40 +1000 506) 
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 507) 	private static void param(Map<String, String> params, String param, boolean content)
9eb5f9f1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-06 11:08:04 +1000 508) 	{
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 509) 		param(params, param, content ? "1" : "0");
a4aa88cf Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-04 11:55:40 +1000 510) 	}
a4aa88cf Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-04 11:55:40 +1000 511) 
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 512) 	private static void param(Map<String, String> params, String param, int content)
fd4fb997 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-15 10:21:55 +1100 513) 	{
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 514) 		param(params, param, Integer.toString(content));
fd4fb997 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-15 10:21:55 +1100 515) 	}
fd4fb997 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-15 10:21:55 +1100 516) 
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 517) 	private static void param(Map<String, String> params, String param, String content)
fd4fb997 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-15 10:21:55 +1100 518) 	{
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 519) 		params.put(param, content);
a4aa88cf Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-04 11:55:40 +1000 520) 	}
a4aa88cf Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-04 11:55:40 +1000 521) 
1995d058 Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-01 16:28:33 +1000 522) 	public class MoodleWebService
1995d058 Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-01 16:28:33 +1000 523) 	{
55677e5b Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-08-18 12:41:02 +1000 524) 		private static final String ERROR_USER_NOT_FOUND = "error/UserNotFound/";
0e40966f Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-01-09 14:32:56 +1100 525) 		private final String url;
0e40966f Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-01-09 14:32:56 +1100 526) 		private final String token;
1995d058 Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-01 16:28:33 +1000 527) 
0e40966f Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-01-09 14:32:56 +1100 528) 		protected MoodleWebService(String url, String token)
1995d058 Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-01 16:28:33 +1000 529) 		{
0e40966f Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-01-09 14:32:56 +1100 530) 			this.url = url;
0e40966f Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-01-09 14:32:56 +1100 531) 			this.token = token;
1995d058 Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-01 16:28:33 +1000 532) 		}
1995d058 Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-01 16:28:33 +1000 533) 
0d5c86df Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (lcook           2012-11-13 16:50:05 +1100 534) 		/**
0d5c86df Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (lcook           2012-11-13 16:50:05 +1100 535) 		 * @param params
0d5c86df Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (lcook           2012-11-13 16:50:05 +1100 536) 		 * @return
0d5c86df Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (lcook           2012-11-13 16:50:05 +1100 537) 		 * @throws LmsUserNotFoundException, MoodleException
0d5c86df Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (lcook           2012-11-13 16:50:05 +1100 538) 		 */
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 539) 		@SuppressWarnings("resource")
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 540) 		public XmlDocument call(Map<String, String> params) throws LmsUserNotFoundException
1995d058 Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-01 16:28:33 +1000 541) 		{
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 542) 			final Request request = new Request(url);
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 543) 			request.setAccept("application/xml; charset=utf-8");
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 544) 			request.setMethod(Method.POST);
6c26aa49 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2012-10-03 17:59:47 +1000 545) 
73be6016 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2012-10-03 16:54:30 +1000 546) 			final List<NameValue> nvs = Lists.newArrayList();
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 547) 			for( Entry<String, String> entry : params.entrySet() )
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 548) 			{
73be6016 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2012-10-03 16:54:30 +1000 549) 				nvs.add(new NameValue(entry.getKey(), entry.getValue()));
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 550) 			}
6c26aa49 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2012-10-03 17:59:47 +1000 551) 			request.setHtmlForm(nvs);
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 552) 
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 553) 			Response response = null;
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 554) 			try
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 555) 			{
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 556) 				response = httpService.getWebContent(request, configService.getProxyDetails());
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 557) 
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 558) 				final EntityStrippingWriter writer = new EntityStrippingWriter(new StringWriter());
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 559) 				final InputSource s = new InputSource();
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 560) 				s.setEncoding(Constants.UTF8);
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 561) 				s.setCharacterStream(new UnicodeReader(response.getInputStream(), "UTF-8"));
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 562) 
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 563) 				final XMLReader r = new Parser();
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 564) 				r.setContentHandler(writer);
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 565) 				r.parse(s);
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 566) 
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 567) 				final XmlDocument xml = new XmlDocument(writer.getOutput());
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 568) 
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 569) 				// Used for testing
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 570) 				if( LOGGER.isDebugEnabled() )
ac21c94a Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-04-03 10:34:20 +1000 571) 				{
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 572) 					LOGGER.debug("Read from server:");
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 573) 					LOGGER.debug(xml.toString());
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 574) 				}
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 575) 
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 576) 				// check to see if XML contains EXCEPTION as first node!
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 577) 				final Node exception = xml.node("EXCEPTION");
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 578) 				if( exception != null )
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 579) 				{
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 580) 					String message = xml.nodeValue("MESSAGE", exception);
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 581) 					if( message.startsWith(ERROR_USER_NOT_FOUND) )
e897b4a2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-19 09:32:38 +1100 582) 					{
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 583) 						String username = message.substring(ERROR_USER_NOT_FOUND.length());
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 584) 						throw new LmsUserNotFoundException(username, CurrentLocale.get(getKey("connector.error"),
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 585) 							username));
55677e5b Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-08-18 12:41:02 +1000 586) 					}
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 587) 					throw new MoodleException("Error contacting Moodle: " + message);
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 588) 				}
9eb5f9f1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-06 11:08:04 +1000 589) 
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 590) 				return xml;
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 591) 			}
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 592) 			catch( Exception e )
ac21c94a Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-04-03 10:34:20 +1000 593) 			{
31f82511 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2013-01-11 11:19:38 +1100 594) 				throw Throwables.propagate(e);
1995d058 Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-01 16:28:33 +1000 595) 			}
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 596) 			finally
1995d058 Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-01 16:28:33 +1000 597) 			{
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 598) 				Closeables.closeQuietly(response);
1995d058 Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-01 16:28:33 +1000 599) 			}
1995d058 Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-01 16:28:33 +1000 600) 		}
1995d058 Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-01 16:28:33 +1000 601) 
1995d058 Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-01 16:28:33 +1000 602) 		public String getUrl()
1995d058 Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-01 16:28:33 +1000 603) 		{
1995d058 Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-01 16:28:33 +1000 604) 			return url;
1995d058 Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-01 16:28:33 +1000 605) 		}
1995d058 Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-01 16:28:33 +1000 606) 
1995d058 Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-01 16:28:33 +1000 607) 		public String getToken()
1995d058 Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-01 16:28:33 +1000 608) 		{
1995d058 Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-01 16:28:33 +1000 609) 			return token;
1995d058 Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-01 16:28:33 +1000 610) 		}
1995d058 Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-01 16:28:33 +1000 611) 	}
a4aa88cf Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-04 11:55:40 +1000 612) 
9eb5f9f1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-06 11:08:04 +1000 613) 	private static class MoodleException extends RuntimeException
9eb5f9f1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-06 11:08:04 +1000 614) 	{
9eb5f9f1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-06 11:08:04 +1000 615) 		private static final long serialVersionUID = 1L;
9eb5f9f1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-06 11:08:04 +1000 616) 
9eb5f9f1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-06 11:08:04 +1000 617) 		public MoodleException(String message)
9eb5f9f1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-06 11:08:04 +1000 618) 		{
9eb5f9f1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-06 11:08:04 +1000 619) 			super(message);
9eb5f9f1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-06 11:08:04 +1000 620) 		}
9eb5f9f1 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-07-06 11:08:04 +1000 621) 	}
8bca0813 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-07-21 14:02:38 +1000 622) 
0224e54d Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-14 15:29:54 +1100 623) 	private String getKey(String partKey)
398f7082 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-08-03 15:18:25 +1000 624) 	{
0224e54d Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-14 15:29:54 +1100 625) 		return "com.tle.core.connectors.moodle." + partKey;
398f7082 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-08-03 15:18:25 +1000 626) 	}
398f7082 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-08-03 15:18:25 +1000 627) 
f7e9e6c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-08-10 16:38:04 +1000 628) 	@Override
707d6cf8 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-05-25 15:25:58 +1000 629) 	public ConnectorTerminology getConnectorTerminology()
398f7082 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-08-03 15:18:25 +1000 630) 	{
f7e9e6c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-08-10 16:38:04 +1000 631) 		ConnectorTerminology terms = new ConnectorTerminology();
0224e54d Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-14 15:29:54 +1100 632) 		terms.setShowArchived(getKey("finduses.showarchived"));
0224e54d Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-14 15:29:54 +1100 633) 		terms.setShowArchivedLocations(getKey("finduses.showarchived.courses"));
0224e54d Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-14 15:29:54 +1100 634) 		terms.setCourseHeading(getKey("finduses.course"));
0224e54d Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2011-12-14 15:29:54 +1100 635) 		terms.setLocationHeading(getKey("finduses.location"));
f7e9e6c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-08-10 16:38:04 +1000 636) 		return terms;
398f7082 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-08-03 15:18:25 +1000 637) 	}
d80c94d2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-08-09 15:41:46 +1000 638) 
d80c94d2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-08-09 15:41:46 +1000 639) 	@Override
fc8a96c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-01-06 10:45:15 +1100 640) 	public boolean supportsExport()
fc8a96c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-01-06 10:45:15 +1100 641) 	{
fc8a96c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-01-06 10:45:15 +1100 642) 		return true;
fc8a96c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-01-06 10:45:15 +1100 643) 	}
fc8a96c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-01-06 10:45:15 +1100 644) 
fc8a96c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-01-06 10:45:15 +1100 645) 	@Override
fc8a96c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-01-06 10:45:15 +1100 646) 	public boolean supportsEdit()
fc8a96c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-01-06 10:45:15 +1100 647) 	{
fc8a96c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-01-06 10:45:15 +1100 648) 		return true;
fc8a96c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-01-06 10:45:15 +1100 649) 	}
fc8a96c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-01-06 10:45:15 +1100 650) 
fc8a96c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-01-06 10:45:15 +1100 651) 	@Override
fc8a96c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-01-06 10:45:15 +1100 652) 	public boolean supportsView()
d80c94d2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-08-09 15:41:46 +1000 653) 	{
d80c94d2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-08-09 15:41:46 +1000 654) 		return true;
d80c94d2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-08-09 15:41:46 +1000 655) 	}
d80c94d2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-08-09 15:41:46 +1000 656) 
d80c94d2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-08-09 15:41:46 +1000 657) 	@Override
fc8a96c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-01-06 10:45:15 +1100 658) 	public boolean supportsDelete()
d80c94d2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-08-09 15:41:46 +1000 659) 	{
d80c94d2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-08-09 15:41:46 +1000 660) 		return true;
d80c94d2 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-08-09 15:41:46 +1000 661) 	}
2e9ae05e Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-20 15:14:37 +1100 662) 
2e9ae05e Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-20 15:14:37 +1100 663) 	@Override
ac21c94a Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-04-03 10:34:20 +1000 664) 	public boolean deleteContent(Connector connector, String username, String id) throws LmsUserNotFoundException
2e9ae05e Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-20 15:14:37 +1100 665) 	{
4d8ffaa9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-21 13:28:38 +1100 666) 		final MoodleWebService ws = setupService(connector);
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 667) 		final Map<String, String> data = functionCall(ws, "equella_delete_item");
4d8ffaa9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-21 13:28:38 +1100 668) 		param(data, "user", username);
4d8ffaa9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-21 13:28:38 +1100 669) 		param(data, "itemid", id);
4d8ffaa9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-21 13:28:38 +1100 670) 
4d8ffaa9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-21 13:28:38 +1100 671) 		XmlDocument response = ws.call(data);
4d8ffaa9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-21 13:28:38 +1100 672) 		for( Node keyNode : response.nodeList("RESPONSE/SINGLE/KEY") )
4d8ffaa9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-21 13:28:38 +1100 673) 		{
4d8ffaa9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-21 13:28:38 +1100 674) 			final String key = keyNode.getAttributes().getNamedItem("name").getNodeValue();
4d8ffaa9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-21 13:28:38 +1100 675) 			final String value = response.nodeValue("VALUE", keyNode);
4d8ffaa9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-21 13:28:38 +1100 676) 			if( key.equals("success") )
4d8ffaa9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-21 13:28:38 +1100 677) 			{
4d8ffaa9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-21 13:28:38 +1100 678) 				return Integer.parseInt(value) == 1;
4d8ffaa9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-21 13:28:38 +1100 679) 			}
4d8ffaa9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-21 13:28:38 +1100 680) 		}
4d8ffaa9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-21 13:28:38 +1100 681) 
4d8ffaa9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-21 13:28:38 +1100 682) 		return false;
4d8ffaa9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-21 13:28:38 +1100 683) 	}
4d8ffaa9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-21 13:28:38 +1100 684) 
4d8ffaa9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-21 13:28:38 +1100 685) 	@Override
dcf694a7 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (nread           2012-03-26 15:38:37 +1100 686) 	public boolean editContent(Connector connector, String username, String contentId, String title, String description)
ac21c94a Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-04-03 10:34:20 +1000 687) 		throws LmsUserNotFoundException
4d8ffaa9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-21 13:28:38 +1100 688) 	{
4d8ffaa9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-21 13:28:38 +1100 689) 		final MoodleWebService ws = setupService(connector);
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 690) 		final Map<String, String> data = functionCall(ws, "equella_edit_item");
4d8ffaa9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-21 13:28:38 +1100 691) 		param(data, "user", username);
4d8ffaa9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-21 13:28:38 +1100 692) 		param(data, "itemid", contentId);
4d8ffaa9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-21 13:28:38 +1100 693) 		param(data, "title", title);
4d8ffaa9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-21 13:28:38 +1100 694) 		param(data, "description", description);
4d8ffaa9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-21 13:28:38 +1100 695) 
4d8ffaa9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-21 13:28:38 +1100 696) 		XmlDocument response = ws.call(data);
4d8ffaa9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-21 13:28:38 +1100 697) 		for( Node keyNode : response.nodeList("RESPONSE/SINGLE/KEY") )
4d8ffaa9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-21 13:28:38 +1100 698) 		{
4d8ffaa9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-21 13:28:38 +1100 699) 			final String key = keyNode.getAttributes().getNamedItem("name").getNodeValue();
4d8ffaa9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-21 13:28:38 +1100 700) 			final String value = response.nodeValue("VALUE", keyNode);
4d8ffaa9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-21 13:28:38 +1100 701) 			if( key.equals("success") )
4d8ffaa9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-21 13:28:38 +1100 702) 			{
4d8ffaa9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-21 13:28:38 +1100 703) 				return Integer.parseInt(value) == 1;
4d8ffaa9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-21 13:28:38 +1100 704) 			}
4d8ffaa9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-21 13:28:38 +1100 705) 		}
4d8ffaa9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-21 13:28:38 +1100 706) 
4d8ffaa9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-21 13:28:38 +1100 707) 		return false;
2e9ae05e Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-20 15:14:37 +1100 708) 	}
4e3e3d06 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-22 15:10:02 +1100 709) 
4e3e3d06 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-22 15:10:02 +1100 710) 	@Override
dcf694a7 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (nread           2012-03-26 15:38:37 +1100 711) 	public boolean moveContent(Connector connector, String username, String contentId, String courseId,
ac21c94a Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-04-03 10:34:20 +1000 712) 		String locationId) throws LmsUserNotFoundException
4e3e3d06 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-22 15:10:02 +1100 713) 	{
4e3e3d06 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-22 15:10:02 +1100 714) 		final MoodleWebService ws = setupService(connector);
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 715) 		final Map<String, String> data = functionCall(ws, "equella_move_item");
4e3e3d06 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-22 15:10:02 +1100 716) 		param(data, "user", username);
4e3e3d06 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-22 15:10:02 +1100 717) 		param(data, "itemid", contentId);
4e3e3d06 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-22 15:10:02 +1100 718) 		param(data, "courseid", courseId);
4e3e3d06 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-22 15:10:02 +1100 719) 		param(data, "locationid", locationId);
4e3e3d06 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-22 15:10:02 +1100 720) 
4e3e3d06 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-22 15:10:02 +1100 721) 		XmlDocument response = ws.call(data);
4e3e3d06 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-22 15:10:02 +1100 722) 		for( Node keyNode : response.nodeList("RESPONSE/SINGLE/KEY") )
4e3e3d06 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-22 15:10:02 +1100 723) 		{
4e3e3d06 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-22 15:10:02 +1100 724) 			final String key = keyNode.getAttributes().getNamedItem("name").getNodeValue();
4e3e3d06 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-22 15:10:02 +1100 725) 			final String value = response.nodeValue("VALUE", keyNode);
4e3e3d06 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-22 15:10:02 +1100 726) 			if( key.equals("success") )
4e3e3d06 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-22 15:10:02 +1100 727) 			{
4e3e3d06 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-22 15:10:02 +1100 728) 				return Integer.parseInt(value) == 1;
4e3e3d06 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-22 15:10:02 +1100 729) 			}
4e3e3d06 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-22 15:10:02 +1100 730) 		}
4e3e3d06 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-22 15:10:02 +1100 731) 
4e3e3d06 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-22 15:10:02 +1100 732) 		return false;
4e3e3d06 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2011-12-22 15:10:02 +1100 733) 	}
b7a11998 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2012-01-12 14:35:43 +1100 734) 
b7a11998 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2012-01-12 14:35:43 +1100 735) 	@Override
b7a11998 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2012-01-12 14:35:43 +1100 736) 	public boolean supportsCourses()
b7a11998 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2012-01-12 14:35:43 +1100 737) 	{
b7a11998 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2012-01-12 14:35:43 +1100 738) 		return true;
b7a11998 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (William Bowling 2012-01-12 14:35:43 +1100 739) 	}
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 740) 
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 741) 	public String testConnection(String serverUrl, String webServiceToken, String username)
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 742) 	{
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 743) 		final MoodleWebService ws = setupService(serverUrl, webServiceToken);
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 744) 
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 745) 		if( Check.isEmpty(serverUrl) )
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 746) 		{
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 747) 			return errorString("connector.test.error.nourl");
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 748) 		}
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 749) 		if( Check.isEmpty(ws.getToken()) )
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 750) 		{
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 751) 			return errorString("connector.test.error.notoken");
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 752) 		}
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 753) 
09e7ce23 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (lcook           2012-11-12 09:34:31 +1100 754) 		// try the URL. Given that this is a test connection method, we aren't
09e7ce23 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (lcook           2012-11-12 09:34:31 +1100 755) 		// fussy about what Exception if any is thrown or the precise semantics
09e7ce23 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (lcook           2012-11-12 09:34:31 +1100 756) 		// of how we catch & handle it
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 757) 		try
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 758) 		{
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 759) 			final URL url = new URL(ws.getUrl());
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 760) 			final HttpURLConnection connection = (HttpURLConnection) url.openConnection();
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 761) 			connection.connect();
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 762) 			connection.disconnect();
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 763) 		}
09e7ce23 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (lcook           2012-11-12 09:34:31 +1100 764) 		catch( Exception e ) // NOSONAR
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 765) 		{
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 766) 			return errorString("connector.test.error.unreachableurl");
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 767) 		}
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 768) 
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 769) 		// call the webservice test function
4e1214c9 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-09-20 10:36:52 +1000 770) 		final Map<String, String> data = functionCall(ws, "equella_test_connection");
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 771) 		param(data, "param", username);
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 772) 
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 773) 		try
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 774) 		{
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 775) 			XmlDocument response = ws.call(data);
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 776) 			for( Node keyNode : response.nodeList("RESPONSE/SINGLE/KEY") )
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 777) 			{
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 778) 				final String key = keyNode.getAttributes().getNamedItem("name").getNodeValue();
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 779) 				final String value = response.nodeValue("VALUE", keyNode);
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 780) 
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 781) 				if( LOGGER.isDebugEnabled() )
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 782) 				{
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 783) 					LOGGER.debug("key: " + key + "   value: " + value);
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 784) 				}
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 785) 
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 786) 				if( key == null || !key.equals("success") || value == null || !value.equals(username) )
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 787) 				{
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 788) 					return errorString("connector.test.error.invalidresponse");
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 789) 				}
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 790) 			}
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 791) 		}
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 792) 		catch( Exception m )
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 793) 		{
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 794) 			return m.getMessage();
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 795) 		}
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 796) 
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 797) 		return null;
2cbc37d5 Source/Plugins/LmsConnectors/com.tle.core.connectors.moodle/src/com/tle/core/connectors/moodle/service/MoodleConnectorService.java (aholland        2012-07-05 17:24:02 +1000 798) 	}
1995d058 Source/Plugins/LmsConnectors/com.tle.core.connectors/src/com/tle/core/connectors/service/MoodleConnectorService.java               (William Bowling 2011-07-01 16:28:33 +1000 799) }
